<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
</head>
<body>
    <header>
        <div class="header-top">
            <div class="header-top-container">

                <div class="header-contact">
                    <span>(+65)</span>
                    <span>Singapore</span>
                </div>
                <p class="header-motto">Shop Smart, Live Better - Your Trusted Online Marketplace!</p>

                <a href="/login/login-signup.html" class="header-top-action">Login<i class='bx bx-user' ></i></a>
            </div>
        </div>

        <div class="nav">
            <div class="nav-logo">
                <h2>Moke<span>Sell</span></h2>
            </div>

            <div class="nav-menu" id="nav-menu">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="/index.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="/about.html" class="nav-link">About</a>
                    </li>
                    <li class="nav-item">
                        <a href="/products.html" class="nav-link">Products</a>
                    </li>
                    <li class="nav-item">
                        <a href="/list.html" class="nav-link">List</a>
                    </li>
                </ul>
                <div class="header-search">
                    <input type="text" placeholder="Search..." class="form-input">
                    <i class='bx bx-search-alt-2' ></i>
                </div>
                <div class="header-user-actions">
                    <a href="wishlist.html" class="header-action-btn">
                        <i class='bx bxs-heart' style="color: red;"></i>
                        <span class="count">3</span>
                    </a>
                    <a href="chats.html" class="header-action-btn">
                        <i class='bx bx-message-square-dots' style="color: black;"></i>
                        <span class="count">3</span>
                    </a>
                </div>
                <div class="header-menu">
                    <i class='bx bx-menu'></i>
                </div>
            </div>
        </div>
    </header>
    <main>
        <h3 class="section-title"><span>Popular</span> Categories</h3>
        <div class="categories-container">
            <div class="category-item" onclick="navigateToCategory('sneakers.html')">
                <div class="category-image-container">
                    <img src="/images/aj1 fragment.webp" alt="Sneakers" class="category-img">
                </div>
                <h3 class="category-title">Sneakers</h3>
            </div>
            <div class="category-item" onclick="navigateToCategory('clothing.html')">
                <div class="category-image-container">
                    <img src="/images/pink stussy.webp" alt="Clothing" class="category-img">
                </div>
                <h3 class="category-title">Clothing</h3>
            </div>
            <div class="category-item" onclick="navigateToCategory('watches.html')">
                <div class="category-image-container">
                    <img src="/images/iphone 16.webp" alt="Watches" class="category-img">
                </div>
                <h3 class="category-title">Electronics</h3>
            </div>
            <div class="category-item" onclick="navigateToCategory('audio-devices.html')">
                <div class="category-image-container">
                    <img src="/images/ap watch.webp" alt="Audio Devices" class="category-img">
                </div>
                <h3 class="category-title">Watches</h3>
            </div>
            <div class="category-item" onclick="navigateToCategory('electronics.html')">
                <div class="category-image-container">
                    <img src="/images/jpg lmlp.webp" alt="Electronics" class="category-img">
                </div>
                <h3 class="category-title">Fragrance</h3>
            </div>
        </div>
        <div class="products-container" id="products-list">
            <div class="tab-btns">
                <span class="tab-btn">Featured</span>
                <span class="tab-btn">Trending</span>
                <span class="tab-btn">Latest</span>
            </div>
            <div class="tab-items">
                <div class="tab-item active-tab">
                    <div class="products-container">
                        <h3 class="section-title"><span>Featured</span> Listings</h3>
                        <div class="grid"> 
                            <!-- Listings will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Account Sidebar (initially hidden) -->
    <div id="account-sidebar" class="account-sidebar">
        <div class="sidebar-content">
        <span id="close-sidebar" class="close-sidebar">&times;</span>
        <h3>Account Info</h3>
        <div id="user-info">
            <!-- This will be populated with the user's name and email -->
        </div>
        <button id="logout-btn" class="logout-btn">Log Out</button>
        </div>
    </div>
    <footer>
        <div class="waves">
            <div class="wave" id="wave1"></div>
            <div class="wave" id="wave2"></div>
            <div class="wave" id="wave3"></div>
            <div class="wave" id="wave4"></div>
        </div>
        <ul class="social-icons">
            <li><a href="#"><i class='bx bxl-instagram-alt'></i></a></li>
            <li><a href="#"><i class='bx bxl-twitter'></i></a></li>
            <li><a href="#"><i class='bx bxl-facebook'></i></a></li>
            <li><a href="#"><i class='bx bxl-linkedin-square'></i></a></li>
        </ul>
        <ul class="menu">
            <li><a href="/index.html">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/products.html">Products</a></li>
            <li><a href="/list.html">List</a></li>
        </ul>
        <p>mokesell@gmail.com.sg | +65 8921 2819 | All Rights Reserved</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // fetching listings for FEATURED from supabase
        const SUPABASE_URL = "https://mtmrilvgybiwyjgqttqr.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10bXJpbHZneWJpd3lqZ3F0dHFyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg4Mjg4OTEsImV4cCI6MjA1NDQwNDg5MX0.1nfCnZmh0jFR9xttubx5b8iaq7awEYPECXLZJNjpHPg";

        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener("DOMContentLoaded", async function () {
            console.log("Supabase Initialized:", supabase);
            await loadFeaturedListings();
        });

        async function loadFeaturedListings() {
            const productContainer = document.querySelector(".grid");

            if (!productContainer) return;

            const categories = ["Sneakers", "Clothing", "Watches", "Electronics"];

            let listings = [];

            for (let category of categories) {
                let { data, error } = await supabase
                    .from("listings")
                    .select("*")
                    .eq("category", category)
                    .limit(1);

                if (error) {
                    console.error(`Error fetching ${category}:`, error);
                    continue;
                }

                if (data.length > 0) {
                    listings.push(data[0]);
                }
            }

            productContainer.innerHTML = ""; // Clear existing listings

            listings.forEach(listing => {
                const listingHTML = `
                    <div class="product-item">
                        <div class="product-banner">
                            <a href="/product/product.html?id=${listing.id}" class="product-images">
                                <img src="${listing.image_url}" alt="${listing.title}" class="product-img default">
                            </a>
                        </div>
                        <div class="product-content">
                            <span class="product-category">${listing.category}</span>
                            <h3 class="product-title">${listing.title}</h3>
                            <div class="product-price flex">
                                <span class="new-price">$${listing.price}</span>
                            </div>
                        </div>
                    </div>
                `;

                productContainer.innerHTML += listingHTML;
            });
        }
    </script>
    <script src="script.js"></script>
</body>
</html>